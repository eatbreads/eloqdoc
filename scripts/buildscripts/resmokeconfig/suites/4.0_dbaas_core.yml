test_kind: js_test

selector:
  roots:
  - tests/jstests/core/**/*.js
  exclude_files:
  - tests/jstests/core/txns/**/*.js
  # The find command fails with a different error message than the one expected when given a
  # non-string collection name argument.
  - tests/jstests/core/commands_with_uuid.js
  # dbadmin.js is timing-sensitive when reporting whether there is clock skew.
  - tests/jstests/core/dbadmin.js
  # These test run commands using legacy queries, which are not supported on sessions.
  - tests/jstests/core/exhaust.js
  - tests/jstests/core/validate_cmd_ns.js
  # Causal consistency is enabled when the retryWrites options is specified in the connection
  # string. This leads to afterClusterTime being specified as a readConcern option, which conflicts
  # with afterOpTime being specified as a readConcern option by the test.
  - tests/jstests/core/read_after_optime.js
  # NEED TO INVESTIGATE
  - tests/jstests/core/bypass_doc_validation.js
  - tests/jstests/core/cannot_create_system_dot_indexes.js
  - tests/jstests/core/collation.js
  # - tests/jstests/core/escaped-logs.js
  # - tests/jstests/core/explain_uuid.js
  - tests/jstests/core/hostinfo.js
  - tests/jstests/core/index9.js
  - tests/jstests/core/index_id_options.js
  - tests/jstests/core/list_all_local_sessions.js
  - tests/jstests/core/list_indexes.js
  - tests/jstests/core/queryoptimizera.js
  - tests/jstests/core/restart_catalog.js
  # crash for eloq
  - tests/jstests/core/*capped*.js
  - tests/jstests/core/indexes_multiple_commands.js
  - tests/jstests/core/create_indexes.js
  - tests/jstests/core/index_multiple_compatibility.js 
  - tests/jstests/core/collection_truncate.js
  - tests/jstests/core/list_indexes_invalidation.js
  - tests/jstests/core/bench_test1.js # assert: 32070.441376549097 is not less than or eq 7120.5 : A1
  - tests/jstests/core/covered_index_negative_1.js # hash index "errmsg" : "error processing query: ns=test.covered_negative_1Tree: f $eq 10.0\nSort: {}\nProj: { f: 1.0, _id: 0.0 }\n planner returned error: bad hint",
  - tests/jstests/core/covered_index_simple_3.js # "errmsg" : "error processing query: ns=test.covered_simple_3Tree: foo $eq 1.0\nSort: {}\nProj: { foo: 1.0, _id: 0.0 }\n planner returned error: bad hint",
  - tests/jstests/core/distinct_index1.js # TypeError: indexScanStage is null
  - tests/jstests/core/existsa.js # "errmsg" : "error processing query: ns=test.jstests_existsaTree: $not\n    a exists\nSort: {}\nProj: {}\n planner returned error: bad hint",
  - tests/jstests/core/find9.js # assert: [120] != [121] are not equal
  - tests/jstests/core/function_string_representations.js # "errmsg" : "Collection::insertDocument got document without _id for ns:local.tmp.mr.function_string_representations_0_test_inc",
  - tests/jstests/core/getmore_invalidated_cursors.js # "errmsg" : "cursor id 11556681461044 not found",
  - tests/jstests/core/index_multikey.js # assert: [true] != [false] are not equal : index should not be marked multikey after failed insert;
  - tests/jstests/core/indext.js # "errmsg" : "error processing query: ns=test.jstests_indextTree: $and\nSort: {}\nProj: {}\n planner returned error: bad hint",
  - tests/jstests/core/insert_long_index_key.js # index for big key should fail
  - tests/jstests/core/list_all_local_cursors.js # "errmsg" : "Unrecognized pipeline stage name: '$listLocalCursors'",
  - tests/jstests/core/list_collections_filter.js # assert: [[ ]] != [[ "lists", "ordered_sets", "unordered_sets" ]] are not equal
  - tests/jstests/core/list_collections_no_views.js # assert: command worked when it should have failed
  - tests/jstests/core/logprocessdetails.js # assert: [false] != [true] are not equal : Process details not present in RAM log
  - tests/jstests/core/max_time_ms.js # assert failed : expected sleep command to abort due to time limit, ok=0, code=59 
  - tests/jstests/core/nestedarr1.js # Error: [146] != [128] are not equal : Number of documents in collection does not match number of entries in index :
  - tests/jstests/core/nestedobj1.js  # assert: [146] != [127] are not equal : Number of documents in collection does not match number of entries in index
  - tests/jstests/core/remove9.js # Error: [500] != [501] are not equal :
  - tests/jstests/core/role_management_helpers.js # Error: Cannot grant nonexistent role roleA@role_management_helpers
  - tests/jstests/core/sortk.js # Error: [1] != [0] are not equal
  - tests/jstests/core/splitvector.js  # Error: 524288 is not greater than 2434500 : A0
  - tests/jstests/core/temp_cleanup.js # "errmsg" : "Collection::insertDocument got document without _id for ns:local.tmp.mr.tempCleanup_1_temp_cleanup_test_inc",
  - tests/jstests/core/uniqueness.js # unique index check
  - tests/jstests/core/views/duplicate_ns.js # assert: [2] != [1] are not equal
  - tests/jstests/core/views/invalid_system_views.js # assert: command worked when it should have failed:
  # - tests/jstests/core/*geo*.js
  # - tests/jstests/core/*fts.js
  - tests/jstests/core/*mr*.js
  - tests/jstests/core/*stages*.js
  - tests/jstests/core/*partial*.js
  - tests/jstests/core/*sparse*.js
  - tests/jstests/core/index13.js # raise Exception
  - tests/jstests/core/indexr.js # raise Exception
  # - tests/jstests/core/or4.js # raise Exception
  # - tests/jstests/core/or6.js
  # - tests/jstests/core/or8.js
  - tests/jstests/core/or_inexact.js # crash
  - tests/jstests/core/queryoptimizer3.js # crash
  - tests/jstests/core/removea.js # Hang!
  - tests/jstests/core/removeb.js # Hang!
  - tests/jstests/core/views/views_all_commands.js
  # slow but meet expectations
  - tests/jstests/core/batch_write_command_insert.js
  - tests/jstests/core/batch_write_command_delete.js
  - tests/jstests/core/batch_write_command_update.js
  exclude_with_any_tags:
  - assumes_superuser_permissions
  - requires_eval_command
  - requires_spawning_own_processes
  - uses_multiple_connections
  - uses_testing_only_commands

executor:
  config:
    shell_options:
      eval: var testingReplication = true;
      readMode: commands
      # ssl: ''
